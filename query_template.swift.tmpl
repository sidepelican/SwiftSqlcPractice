// Code generated by sqlc using sqlc-gen-from-template; DO NOT EDIT.
// Template: query_template.swift.tmpl

import Foundation
import SQLiteNIO

public enum Query {
{{- range .Queries }}

  public struct {{ .Name }}: Sendable {
    public static var sql: String { """
{{ .Text }}
""" }

    {{- range $i, $p := .Params }}
    public var {{ $p.Column.Name }}: {{- $t := $p.Column.Type.Name -}}{{ if or (eq $t "INTEGER") (eq $t "integer") }}Int{{ else if or (eq $t "REAL") (eq $t "real") }}Double{{ else if or (eq $t "TEXT") (eq $t "text") }}String{{ else if or (eq $t "BLOB") (eq $t "blob") }}Data{{ else }}String{{ end }}{{ if not $p.Column.NotNull }}?{{ end }}
    {{- end }}
    public init({{- range $i, $p := .Params }}{{ if $i }}, {{ end }}{{ $p.Column.Name }}: {{- $t := $p.Column.Type.Name -}}{{ if or (eq $t "INTEGER") (eq $t "integer") }}Int{{ else if or (eq $t "REAL") (eq $t "real") }}Double{{ else if or (eq $t "TEXT") (eq $t "text") }}String{{ else if or (eq $t "BLOB") (eq $t "blob") }}Data{{ else }}String{{ end }}{{ if not $p.Column.NotNull }}?{{ end }}{{- end }}) {
      {{- range $i, $p := .Params }}
      self.{{ $p.Column.Name }} = {{ $p.Column.Name }}
      {{- end }}
    }

    public struct Row: Sendable {
    {{- range $i, $c := .Columns }}
      public var {{ $c.Name }}: {{- $t := $c.Type.Name -}}{{ if or (eq $t "INTEGER") (eq $t "integer") }}Int{{ else if or (eq $t "REAL") (eq $t "real") }}Double{{ else if or (eq $t "TEXT") (eq $t "text") }}String{{ else if or (eq $t "BLOB") (eq $t "blob") }}Data{{ else }}String{{ end }}{{ if not $c.NotNull }}?{{ end }}
    {{- end }}
    }

    {{- if eq .Cmd ":many" }}
    public func execute(on db: SQLiteConnection) async throws -> [Row] {
      var query = SqlcQueryBuilder(Self.sql)
      {{- range $i, $p := .Params }}
      query.bind({{ $p.Column.Name }})
      {{- end }}
      let rows = try await db.execute(query)
      var result: [Row] = []
      result.reserveCapacity(rows.count)
      for row in rows {
        let columns = row.columns
        result.append(Row(
        {{- range $i, $c := .Columns }}
          {{- if $i }}, {{ end -}}
          {{ $c.Name }}: try .decode(from: columns[{{ $i }}])
        {{- end }}
        ))
      }
      return result
    }
    {{- else if eq .Cmd ":one" }}
    public func execute(on db: SQLiteConnection) async throws -> Row? {
      var query = SqlcQueryBuilder(Self.sql)
      {{- range $i, $p := .Params }}
      query.bind({{ $p.Column.Name }})
      {{- end }}
      if let row = try await db.execute(query).first {
        let columns = row.columns
        return Row(
        {{- range $i, $c := .Columns }}
          {{- if $i }}, {{ end -}}
          {{ $c.Name }}: try .decode(from: columns[{{ $i }}])
        {{- end }}
        )
      }
      return nil
    }
    {{- else }}
    public func execute(on db: SQLiteConnection) async throws {
      var query = SqlcQueryBuilder(Self.sql)
      {{- range $i, $p := .Params }}
      query.bind({{ $p.Column.Name }})
      {{- end }}
      _ = try await db.execute(query)
    }
    {{- end }}
  }
{{- end }}
}
